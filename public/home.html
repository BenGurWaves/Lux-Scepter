<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
 <title>LUX SCEPTER â€¢ Home</title>
 <style>
   body{background:#000;color:#D4AF37;font-family:system-ui;margin:0;padding:20px;}
   .header{background:#111;padding:15px;text-align:center;position:fixed;top:0;left:0;right:0;z-index:10;}
   .feed{max-width:600px;margin:80px auto 100px;}
   .post{background:#111;margin:20px 0;padding:20px;border:1px solid #333;}
   video, img{max-width:100%;border-radius:8px;}
   .upload-box{background:#111;padding:30px;text-align:center;border:2px dashed #D4AF37;margin:40px 0;}
   .logout{position:fixed;bottom:20px;right:20px;color:#888;}
 </style>
</head>
<body>
  <div class="header">
    <h1>LUX SCEPTER</h1>
    <p>Welcome, <span id="user"></span></p>
  </div>

  <div class="upload-box">
    <input type="file" id="file" accept="image/*,video/*" />
    <button onclick="upload()">Upload Edict / Dominion</button>
    <p id="status"></p>
  </div>

  <div class="feed" id="feed">Loading realm...</div>
  <a href="/signout" class="logout">Sign Out</a>

  <script>
    const token = localStorage.getItem('lux_token');
    if (!token) location.href = '/';

    fetch('/api/me', {headers:{Authorization:`Bearer ${token}`}})
      .then(r=>r.json())
      .then(u=>document.getElementById('user').textContent = u.username);

    // Load public feed
    fetch('/api/feed').then(r=>r.json()).then(posts=>{
      const feed = document.getElementById('feed');
      feed.innerHTML = posts.map(p=>`
        <div class="post">
          <strong>@${p.username}</strong>
          ${p.type.startsWith('video') ? `<video controls src="${p.url}"></video>` : `<img src="${p.url}">`}
          <small>${new Date(p.ts).toLocaleString()}</small>
        </div>
      `).join('');
    });

    async function upload() {
      const file = document.getElementById('file').files[0];
      if (!file) return;
      document.getElementById('status').textContent = 'Getting secure link...';
      const res = await fetch('/api/upload-url', {
        method:'POST',
        headers:{'Content-Type':'application/json', Authorization:`Bearer ${token}`},
        body:JSON.stringify({filename:file.name, type:file.type})
      });
      const {url} = await res.json();
      await fetch(url, {method:'PUT', body:file});
      document.getElementById('status').textContent = 'Uploaded! Refresh in 5s.';
      setTimeout(()=>location.reload(),5000);
    }
  </script>
</body>
</html>
